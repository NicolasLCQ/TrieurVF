"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

exports.default = limit => {
  // Internal state to keep track of running and queued jobs
  const jobs = {
    running: 0,
    queue: []
  };

  // Return a wrapper function
  return (inputFunction
  // ...that returns a wrapped version of the function
  ) => (...args
  // ...that returns a wrapper promise
  ) => new Promise((resolve, reject) => {
    // Wrapper function to run this job
    const runJob = () => {
      jobs.running += 1;

      // Run the given input function with given arguments
      inputFunction(...args).then(resolve, reject).then(() => {
        jobs.running -= 1;

        // Run next job if there is one
        if (jobs.queue.length > 0) {
          jobs.queue.shift()();
        }
      });
    };

    // Either run the job right away or queue it if needed
    if (jobs.running < limit) {
      runJob();
    } else {
      jobs.queue.push(runJob);
    }
  });
};

module.exports = exports["default"];